<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Collection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            margin: 0;
            background-color: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        .menu-container {
            width: 300px;
            background: white;
            border-right: 1px solid #ddd;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .menu-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .menu-title {
            text-align: center;
            color: #333;
            margin: 0 0 15px 0;
            font-size: 1.5em;
            letter-spacing: 2px;
        }

        #searchInput {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* Filter controls styling */
        .filter-controls {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-label {
            font-weight: bold;
            font-size: 0.9em;
            color: #555;
        }

        .filter-button {
            padding: 5px 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .filter-button:hover {
            background-color: #e0e0e0;
        }

        .filter-button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .filter-select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }

        .menu {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }

        .menu-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-item:hover {
            background-color: #f0f0f0;
        }

        .menu-item.selected {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .description-container {
            flex: 1;
            padding: 20px;
            background: white;
            overflow-y: auto;
            position: relative;
        }

        /* Updated media container and image styles */
        .media-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .media-item {
            height: 0;
            padding-bottom: 100%;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: #f0f0f0;
        }

        .media-item img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #f8f8f8;
            transition: all 0.3s ease;
        }

        .media-item:hover img {
            transform: scale(1.02);
        }

        .media-item .no-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        .media-fullsize {
            grid-column: span 2;
            height: 0;
            padding-bottom: 56.25%;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .game-title {
            font-size: 1.8em;
            margin: 0;
            color: #333;
        }

        .game-date {
            color: #777;
            font-size: 0.9em;
        }

        .game-detail {
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .game-detail-label {
            font-weight: bold;
            display: inline-block;
            width: 120px;
            color: #555;
        }

        .rating-stars {
            color: gold;
            font-size: 1.3em;
            letter-spacing: 3px;
        }

        .strikes {
            color: #ff4444;
            font-size: 1.3em;
            letter-spacing: 5px;
        }

        .platform-tag {
            display: inline-block;
            padding: 3px 8px;
            background-color: #e0e0e0;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .finished-status {
            font-weight: bold;
        }

        .finished-yes {
            color: #28a745;
        }

        .finished-no {
            color: #6c757d;
        }
		
		.is_checked-status {
            font-weight: bold;
        }

        .is_checked-yes {
            color: #28a745;
        }

        .is_checked-no {
            color: #6c757d;
        }

        .game-link {
            color: #007bff;
            text-decoration: none;
            word-break: break-all;
        }

        .game-link:hover {
            text-decoration: underline;
        }

		.game-notes {
			white-space: pre-wrap;
			line-height: 1.6;
			margin-top: 20px;
			padding: 15px;
			background-color: #f8f9fa;
			border-radius: 4px;
			border-left: 4px solid #007bff;
			overflow-y: auto;  /* Enables vertical scrolling when needed */
			max-height: 200px; /* Set a maximum height for the container */
			word-wrap: break-word; /* Ensures long words break and wrap */
		}

        .entry-actions {
            display: flex;
            gap: 10px;
            position: absolute;
            bottom: 20px;
            right: 20px;
        }
		
				/* Add this with the other button styles */
		.save-btn {
			padding: 8px 15px;
			background-color: #28a745;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-size: 14px;
		}

		.save-btn:hover {
			background-color: #218838;
		}

        .edit-btn, .delete-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .edit-btn {
            background-color: #ffc107;
            color: black;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }

        .add-entry {
            padding: 10px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        #newEntryBtn {
            padding: 8px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
            font-weight: bold;
        }

        .no-selection {
            color: #777;
            text-align: center;
            margin-top: 50px;
            font-size: 1.2em;
        }

        .no-results {
            color: #777;
            text-align: center;
            padding: 20px;
        }

        #exportBtn, #importBtn {
            padding: 8px 15px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 48%;
            box-sizing: border-box;
            margin-top: 10px;
        }

        #exportBtn:hover, #importBtn:hover {
            background-color: #5a6268;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 4%;
        }

        /* Media queries for responsive design */
        @media screen and (max-width: 1200px) {
            .media-container {
                display: flex;
                flex-direction: column;
            }

            .media-item {
                padding-bottom: 70%;
            }

            .media-fullsize {
                padding-bottom: 70%;
            }
        }

        /* Key navigation indicator */
        .keyboard-shortcuts {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
<div class="menu-container">
    <div class="menu-header">
        <h2 class="menu-title">GAME COLLECTION</h2>
        <input type="text" id="searchInput" placeholder="Search games...">
    </div>
    <!-- Added filter controls -->
    <div class="filter-controls">
		<div class="filter-row">
			<span class="filter-label">Sort by:</span>
			<div>
				<button id="sortAlpha" class="filter-button active" onclick="setSortMethod('alpha', document.getElementById('sortAlpha'))">A-Z</button>
				<button id="sortDate" class="filter-button" onclick="setSortMethod('date', document.getElementById('sortDate'))">Date</button>
				<button id="sortRating" class="filter-button" onclick="setSortMethod('rating', document.getElementById('sortRating'))">Rating</button>
				<button id="bulkImportBtn" class="filter-button" onclick="document.getElementById('bulkTextInput').click()">TxT</button>
			    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="importGames(this)">
				<input type="file" id="bulkTextInput" accept=".txt" style="display: none;" onchange="bulkImportTitles(this)">
			</div>
		</div>
        <div class="filter-row">
            <span class="filter-label">Finished:</span>
            <select id="finishedFilter" class="filter-select" onchange="applyFilters()">
                <option value="all">All</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
			<span class="filter-label">Checked:</span>
            <select id="isCheckedFilter" class="filter-select" onchange="applyFilters()">
                <option value="all">All</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>

        <div class="filter-row">
            <span class="filter-label">Platform:</span>
            <select id="platformFilter" class="filter-select" onchange="applyFilters()">
                <option value="all">All</option>
                <!-- Platform options will be populated by JavaScript -->
            </select>
        </div>
    </div>
    <div class="menu" id="menu">
        <!-- Games will be populated by JavaScript -->
    </div>
    <div class="add-entry">
        <button id="newEntryBtn" onclick="window.location.href='new-game.html'">ADD GAME</button>
        <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="importGames(this)">
    </div>
</div>

<div class="description-container" id="descriptionContainer">
    <div class="no-selection">Select a game to view details</div>
</div>

<script>
    const { ipcRenderer } = require('electron');
    let games = [];
    let filteredGames = [];
    let selectedIndex = -1;
    let selectedId = -1;
    let currentSortMethod = 'alpha';
    let uniquePlatforms = new Set();

    async function loadGames() {
        try {
            const response = await fetch('http://localhost:3000/games/list');
            const newGames = await response.json();
            
            // Only update if the data has actually changed
            if (JSON.stringify(games) !== JSON.stringify(newGames)) {
                games = newGames;
                populatePlatformOptions();
                // Preserve current filters and selection when refreshing
                applyFilters();
            }
        } catch (error) {
            console.error('Error loading games:', error);
        }
    }

    function updateSelection(index, id) {
        selectedIndex = index;
        selectedId = id;
        const items = document.querySelectorAll('.menu-item');
        
        if (index >= 0 && index < filteredGames.length) {
            const game = filteredGames[index];
            
            items.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('selected');
                    
                    // Generate stars for rage rating
                    let stars = '';
                    for (let i = 0; i < 3; i++) {
                        stars += i < game.rageRating ? '★' : '☆';
                    }

                    // Generate strikes
                    let strikes = '';
                    let strikeCount = game.strikes || 0;
                    strikeCount = Math.max(0, Math.min(3, strikeCount));
                    
                    for (let i = 0; i < strikeCount; i++) {
                        strikes += 'X';
                        if (i < strikeCount - 1) {
                            strikes += ' ';
                        }
                    }

                    // Media container HTML
                    let mediaContainerHtml = '<div class="media-container">';

                    // Cover art
                    if (game.coverArtPath) {
                        mediaContainerHtml += `
                            <div class="media-item">
                                <img src="${game.coverArtPath}" onerror="this.parentNode.innerHTML='<div class=\\'no-image\\'>No Cover Art</div>'">
                            </div>`;
                    } else {
                        mediaContainerHtml += `
                            <div class="media-item">
                                <div class="no-image">No Cover Art</div>
                            </div>`;
                    }

                    // Gameplay photo
                    if (game.gameplayImagePath) {
                        mediaContainerHtml += `
                            <div class="media-item">
                                <img src="${game.gameplayImagePath}" onerror="this.parentNode.innerHTML='<div class=\\'no-image\\'>No Gameplay Image</div>'">
                            </div>`;
                    } else {
                        mediaContainerHtml += `
                            <div class="media-item">
                                <div class="no-image">No Gameplay Image</div>
                            </div>`;
                    }

                    mediaContainerHtml += '</div>';

                    // Update the description container
                    document.getElementById('descriptionContainer').innerHTML = `
                        ${mediaContainerHtml}
                        <div class="game-header">
                            <h2 class="game-title">${game.title}</h2>
                            <div class="game-date">Added: ${new Date(game.dateAdded).toLocaleDateString()}</div>
                        </div>

                        <div class="game-detail">
                            <span class="game-detail-label">Link:</span>
                            <a href="${game.link}" class="game-link" target="_blank">${game.link || 'N/A'}</a>
                        </div>

                        <div class="game-detail">
                            <span class="game-detail-label">Rage Rating:</span>
                            <span class="rating-stars">${stars}</span>
                        </div>

                        <div class="game-detail">
                            <span class="game-detail-label">Finished:</span>
                            <span class="finished-status ${game.finished ? 'finished-yes' : 'finished-no'}">
                                ${game.finished ? 'Yes' : 'No'}
                            </span>
                        </div>
						
						<div class="game-detail">
                            <span class="game-detail-label">Checked:</span>
                            <span class="is_checked-status ${game.is_checked ? 'is_checked-yes' : 'is_checked-no'}">
                                ${game.is_checked ? 'Yes' : 'No'}
                            </span>
                        </div>
						
                        <div class="game-detail">
                            <span class="game-detail-label">Platform:</span>
                            <span class="platform-tag">${game.platform || 'Not specified'}</span>
                        </div>

                        <div class="game-detail">
                            <span class="game-detail-label">Three Strikes:</span>
                            <span class="strikes">${strikes}</span>
                            <small style="margin-left: 8px; color: #777;">(${strikeCount}/3)</small>
                        </div>

                        ${game.notes ? `
                        <div class="game-notes">
                            <strong>Notes:</strong><br>
                            ${game.notes}
                        </div>
                        ` : ''}

                        <div class="entry-actions">
							<button class="save-btn" onclick="saveGameFiles(${game.id})">Save</button>
                            <button class="edit-btn" onclick="editGame(${game.id})">Edit</button>
                            <button class="delete-btn" onclick="deleteGame(${game.id})">Delete</button>
                        </div>
                    `;

                    // Add click handlers for images
                    setTimeout(() => {
                        const mediaItems = document.querySelectorAll('.media-item');
                        mediaItems.forEach(item => {
                            item.addEventListener('click', function() {
                                if (this.classList.contains('media-fullsize')) {
                                    this.classList.remove('media-fullsize');
                                } else {
                                    mediaItems.forEach(i => i.classList.remove('media-fullsize'));
                                    this.classList.add('media-fullsize');
                                }
                            });
                        });
                    }, 100);

                    // Scroll menu into view if needed
                    const menuContainer = document.querySelector('.menu');
                    if (item) {
                        const itemTop = item.offsetTop;
                        const itemBottom = itemTop + item.offsetHeight;
                        const containerScrollTop = menuContainer.scrollTop;
                        const containerBottom = containerScrollTop + menuContainer.offsetHeight;

                        if (itemTop < containerScrollTop) {
                            menuContainer.scrollTop = itemTop;
                        } else if (itemBottom > containerBottom) {
                            menuContainer.scrollTop = itemBottom - menuContainer.offsetHeight;
                        }
                    }
                } else {
                    item.classList.remove('selected');
                }
            });
        }
    }

    function editGame(id) {
        window.location.href = `edit-game.html?id=${id}`;
    }

    async function deleteGame(id) {
        if (confirm('Are you sure you want to delete this game?')) {
            try {
                const response = await fetch(`http://localhost:3000/games/delete/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    await loadGames();
                    if (filteredGames.length > 0) {
                        updateSelection(0, filteredGames[0].id);
                    } else {
                        document.getElementById('descriptionContainer').innerHTML = 
                            '<div class="no-selection">No games to display</div>';
                    }
                } else {
                    const error = await response.json();
                    alert('Error deleting game: ' + error.error);
                }
            } catch (error) {
                console.error('Error deleting game:', error);
                alert('Error deleting game: ' + error.message);
            }
        }
    }

    async function exportGames() {
        try {
            const response = await fetch('http://localhost:3000/games/export');
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'game_collection_export.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            } else {
                const error = await response.text();
                alert('Export failed: ' + error);
            }
        } catch (error) {
            console.error('Export error:', error);
            alert('Export failed: ' + error.message);
        }
    }
		
	async function bulkImportTitles(input) {
		const file = input.files[0];
		if (!file) return;

		if (!confirm('This will create new entries for each line in the text file. Continue?')) {
			input.value = '';
			return;
		}

		try {
			const text = await file.text();
			const titles = text.split('\n')
				.map(title => title.trim())
				.filter(title => title.length > 0);

			if (titles.length === 0) {
				throw new Error('No valid titles found in the file');
			}

			const confirmation = confirm(`Found ${titles.length} titles. Create entries?`);
			if (!confirmation) {
				input.value = '';
				return;
			}

			const response = await fetch('http://localhost:3000/games/bulk-create', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({ titles })
			});

			if (!response.ok) {
				const errorText = await response.text();
				try {
					// Try to parse as JSON first
					const errorData = JSON.parse(errorText);
					throw new Error(errorData.error || 'Bulk import failed');
				} catch (e) {
					// If not JSON, use the raw text
					throw new Error(errorText || 'Bulk import failed');
				}
			}

			const result = await response.json();
			alert(`Successfully created ${result.createdCount} new entries`);
			await loadGames();
		} catch (error) {
			console.error('Bulk import error:', error);
			alert('Bulk import failed: ' + error.message);
		} finally {
			input.value = '';
		}
	}

    async function importGames(input) {
        const file = input.files[0];
        if (!file) return;

        if (!confirm('Importing will replace all current games. Continue?')) {
            input.value = '';
            return;
        }

        try {
            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch('http://localhost:3000/games/import', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Import failed');
            }

            const result = await response.json();
            alert(result.message);
            await loadGames();
        } catch (error) {
            console.error('Import error:', error);
            alert('Import failed: ' + error.message);
        } finally {
            input.value = '';
        }
    }

	function setSortMethod(method, button) {
		// Update the active button state for sort buttons only
		document.querySelectorAll('#sortAlpha, #sortDate, #sortRating').forEach(btn => {
			btn.classList.remove('active');
		});
		button.classList.add('active');
		
		// Update the current sort method
		currentSortMethod = method;
		
		// Reapply filters with new sorting
		applyFilters();
	}

    function populatePlatformOptions() {
        uniquePlatforms.clear();
        games.forEach(game => {
            if (game.platform && game.platform.trim() !== '') {
                uniquePlatforms.add(game.platform);
            }
        });

        const platformFilter = document.getElementById('platformFilter');
        const currentValue = platformFilter.value;
        
        while (platformFilter.options.length > 1) {
            platformFilter.remove(1);
        }

        uniquePlatforms.forEach(platform => {
            const option = document.createElement('option');
            option.value = platform;
            option.textContent = platform;
            platformFilter.appendChild(option);
        });

        if (Array.from(platformFilter.options).some(opt => opt.value === currentValue)) {
            platformFilter.value = currentValue;
        }
    }
	
	async function saveGameFiles(id) {
		try {
			// Get the game details
			const response = await fetch(`http://localhost:3000/games/${id}`);
			const game = await response.json();
			
			if (!game) {
				throw new Error('Game not found');
			}

			// Call the Electron function to open the folder
			const result = await ipcRenderer.invoke('open-game-folder', game.title);
			
			if (!result.success) {
				alert(result.message || 'Failed to open folder');
			}
		} catch (error) {
			console.error('Error saving game files:', error);
			alert('Error: ' + error.message);
		}
	}

	function applyFilters() {
		const searchTerm = document.getElementById('searchInput').value.toLowerCase();
		const finishedFilter = document.getElementById('finishedFilter').value;
		const isCheckedFilter = document.getElementById('isCheckedFilter').value;
		const platformFilter = document.getElementById('platformFilter').value;

		filteredGames = games.filter(game => {
			const matchesSearch = searchTerm === '' ||
				game.title.toLowerCase().includes(searchTerm) ||
				(game.platform && game.platform.toLowerCase().includes(searchTerm)) ||
				(game.notes && game.notes.toLowerCase().includes(searchTerm));

			const matchesFinished = finishedFilter === 'all' ||
				(finishedFilter === 'yes' && game.finished) ||
				(finishedFilter === 'no' && !game.finished);
				
			const matchesIsChecked = isCheckedFilter === 'all' ||
				(isCheckedFilter === 'yes' && game.is_checked) ||
				(isCheckedFilter === 'no' && !game.is_checked);

			const matchesPlatform = platformFilter === 'all' ||
				game.platform === platformFilter;

			return matchesSearch && matchesFinished && matchesPlatform && matchesIsChecked;
		});

		// Apply sorting - using slice() to create a new array
		const sortedGames = filteredGames.slice().sort((a, b) => {
			switch(currentSortMethod) {
				case 'alpha':
					return a.title.localeCompare(b.title);
				case 'date':
					return b.id - a.id;
				case 'rating':
					// Handle null/undefined ratings by treating them as 0
					const aRating = a.rageRating || 0;
					const bRating = b.rageRating || 0;
					return bRating - aRating;
				default:
					return 0;
			}
		});

		filteredGames = sortedGames;
		renderMenu();

		// Preserve selection if the currently selected game is still in filtered results
		let newSelectedIndex = -1;
		if (selectedId >= 0) {
			newSelectedIndex = filteredGames.findIndex(game => game.id === selectedId);
		}
		
		// If current selection not found, select first item
		if (newSelectedIndex === -1 && filteredGames.length > 0) {
			newSelectedIndex = 0;
		}

		selectedIndex = newSelectedIndex;
		selectedId = selectedIndex >= 0 ? filteredGames[selectedIndex].id : -1;

		if (selectedIndex >= 0) {
			updateSelection(selectedIndex, selectedId);
		} else {
			document.getElementById('descriptionContainer').innerHTML =
				'<div class="no-selection">No games match your filters</div>';
		}
	}

    function renderMenu() {
        const menu = document.getElementById('menu');
        menu.innerHTML = '';

        if (filteredGames.length === 0) {
            menu.innerHTML = '<div class="no-results">No games found</div>';
            return;
        }

        filteredGames.forEach((game, index) => {
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item' + (index === selectedIndex ? ' selected' : '');
            menuItem.onclick = () => updateSelection(index, game.id);
            menuItem.innerHTML = `
                <div><strong>${game.title}</strong></div>
            `;
            menu.appendChild(menuItem);
        });
    }

    // Initialize the app
    document.addEventListener('DOMContentLoaded', () => {
        loadGames();
        
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        
        document.addEventListener('keydown', function(e) {
            if (filteredGames.length === 0) return;

            const oldSelectedIndex = selectedIndex;
            const descriptionContainer = document.getElementById('descriptionContainer');

			if (e.code === 'ArrowUp') {
				selectedIndex = Math.max(0, selectedIndex - 1);
				e.preventDefault();
				if (oldSelectedIndex !== selectedIndex) {
					updateSelection(selectedIndex, filteredGames[selectedIndex].id);
				}
			}
			else if (e.code === 'ArrowDown') {
				selectedIndex = Math.min(filteredGames.length - 1, selectedIndex + 1);
				e.preventDefault();
				if (oldSelectedIndex !== selectedIndex) {
					updateSelection(selectedIndex, filteredGames[selectedIndex].id);
				}
			}

            else if (e.key === 'ArrowLeft') {
                descriptionContainer.scrollBy({
                    top: -300,
                    behavior: 'smooth'
                });
                e.preventDefault();
            }
            else if (e.key === 'ArrowRight') {
                descriptionContainer.scrollBy({
                    top: 300,
                    behavior: 'smooth'
                });
                e.preventDefault();
            }
        });
    });

    // Poll for updates every 5 seconds, but preserve filters
    setInterval(loadGames, 5000);
</script>
</body>
</html>